(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-10025d17"],{2909:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));a("277d");var r=a("6b75");function n(e){if(Array.isArray(e))return Object(r["a"])(e)}a("a4d3"),a("e01a"),a("d28b"),a("a630"),a("e260"),a("d3b7"),a("3ca3"),a("ddb0");function i(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}var s=a("06c5");function l(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(e){return n(e)||i(e)||Object(s["a"])(e)||l()}},"3bc7":function(e,t,a){"use strict";var r=a("daaf"),n=a.n(r);n.a},"4a2b":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"main"},[a("div",{staticClass:"wrapper"},[a("h2",[e._v("用户管理")]),a("div",{staticClass:"button-wrapper"}),a("el-card",{staticClass:"box-card"},[a("el-input",{staticStyle:{width:"250px"},attrs:{placeholder:"搜索用户",clearable:""},on:{input:function(t){return e.searchUser(e.searchText,1,e.pageSize)}},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}}),a("el-button",{staticStyle:{float:"right"},on:{click:e.createNewUser}},[a("i",{staticClass:"el-icon-plus"}),e._v("添加 ")]),a("div",{staticClass:"table-wrap"},[a("normal-table",{attrs:{tableData:e.tableData,columns:e.columns,created:e.newUser,changed:e.userEdit,deleteFlag:e.deleteFlag,index:!0},on:{handleEdit:e.editUser,handleDelete:e.handleDelete},scopedSlots:e._u([{key:"roles",fn:function(t){var a=t.scope;return[e._v(e._s(e.getRoleName(a.row.roles)))]}},{key:"clazz",fn:function(t){var a=t.scope;return[e._v(e._s(e.getClassName(a.row.clazz)))]}}])})],1),a("div",{staticClass:"block"},[a("el-pagination",{attrs:{layout:"prev,pager,next","current-page":e.currentPage,total:e.total,"page-size":e.pageSize,background:""},on:{"current-change":e.currentChange}})],1)],1),a("el-dialog",{attrs:{visible:e.dialogFormShow,title:e.dialogStatus[e.flag],center:"",width:"500px"},on:{"update:visible":function(t){e.dialogFormShow=t}}},[a("el-form",{ref:"dialog",attrs:{model:e.dialog,rules:e.checkRules(),size:"mini"}},[a("el-form-item",{attrs:{label:"用户名",prop:"name"}},[a("el-input",{attrs:{maxlength:"10"},model:{value:e.dialog.name,callback:function(t){e.$set(e.dialog,"name",t)},expression:"dialog.name"}})],1),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{type:"password"},model:{value:e.dialog.password,callback:function(t){e.$set(e.dialog,"password",t)},expression:"dialog.password"}})],1),a("el-form-item",{attrs:{label:"确认密码",prop:"checkPass"}},[a("el-input",{attrs:{type:"password"},model:{value:e.dialog.checkPass,callback:function(t){e.$set(e.dialog,"checkPass",t)},expression:"dialog.checkPass"}})],1),a("el-form-item",{attrs:{label:"权限",prop:"roles"}},[a("el-select",{attrs:{multiple:"","value-key":"id",placeholder:"请选择"},model:{value:e.dialog.roles,callback:function(t){e.$set(e.dialog,"roles",t)},expression:"dialog.roles"}},e._l(e.roles,(function(e){return a("el-option",{key:e.id,attrs:{label:e.role_name,value:e}})})),1)],1),a("el-form-item",{attrs:{label:"班级",prop:"clazz"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.dialog.clazz,callback:function(t){e.$set(e.dialog,"clazz",t)},expression:"dialog.clazz"}},e._l(e.classes,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){"edit"===e.flag?e.handleUpdate():e.handleCreate()}}},[e._v("提交")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogFormShow=!1}}},[e._v("取消")])],1)],1)],1)])},n=[],i=(a("99af"),a("d81d"),a("b0c0"),a("5530")),s=a("2909"),l=a("4db3");function o(e,t){return Object(l["a"])({url:"/api/user/page",params:{page:e,size:t}})}function c(e){return Object(l["a"])({url:"/api/user/",method:"put",data:e})}function d(e){return Object(l["a"])({url:"/api/user/",method:"post",data:e})}function u(e){return Object(l["a"])({url:"/api/user/"+e,method:"delete"})}function g(){return Object(l["a"])({url:"/api/user/roles"})}function h(e,t,a){return Object(l["a"])({url:"/api/user/search",params:{name:e,page:t,size:a}})}var f=a("4360"),p=a("7e35"),m={name:"userManage",components:{normalTable:p["a"]},data:function(){var e=this,t=function(t,a,r){var n=/^[\w_-]{6,16}$/;n.test(a)?(""!==e.dialog.checkPass&&e.$refs.dialog.validateField("checkPass"),r()):r(new Error("密码不符合"))},a=function(e,t,a){var r=/^[a-zA-Z0-9]+$/;""===t?a(new Error("请输入用户名")):r.test(t)?t.length<5?a(new Error("用户名长度应大于5")):a():a(new Error("用户名不能包括字符"))},r=function(t,a,r){a&&a.length<8?r(new Error("密码不符合")):(""!==e.dialog.checkPass&&e.$refs.dialog.validateField("checkPass"),r())},n=function(t,a,r){"create"===e.flag&&null!==a&&""===a?r(new Error("请再次输入密码")):a!==e.dialog.password?r(new Error("两次输入密码不一致!")):r()};return{tableData:[],currentPage:1,pageSize:5,total:void 0,searchText:"",searchFlag:!1,roles:[],role_id:void 0,classes:[{id:-2,name:"无"}].concat(Object(s["a"])(f["a"].getters.classes)),dialog:{id:void 0,name:"",roles:[],clazz:void 0,password:"",checkPass:""},dialogFormShow:!1,dialogStatus:{create:"添加新用户",edit:"修改用户信息"},flag:"",btn_stu:!1,newUser:null,userEdit:null,deleteFlag:!1,editRule:{name:[{validator:a,trigger:"change"}],password:[{validator:r,trigger:"change"}],checkPass:[{validator:n,trigger:"change"}],roles:[{required:!0,message:"请选择角色",trigger:"change"}],clazz:[{required:!0,message:"请选择班级",trigger:"change"}]},createRule:{name:[{validator:a,trigger:"blur"}],password:[{validator:t,trigger:"blur"}],checkPass:[{validator:n,trigger:"blur"}],roles:[{required:!0,message:"请选择角色",trigger:"change"}],clazz:[{required:!0,message:"请选择班级",trigger:"change"}]},columns:[{id:"name",label:"用户名"},{id:"roles",label:"权限"},{id:"clazz",label:"班级"}]}},created:function(){this.initUser(),this.initRoles()},computed:{name:function(){return f["a"].getters.name}},watch:{searchText:function(){""===this.searchText&&(this.searchFlag=!1)}},methods:{initUser:function(){var e=this;o(this.currentPage,this.pageSize).then((function(t){e.tableData=t.data.data,e.total=t.data.total}))},initRoles:function(){var e=this;g().then((function(t){e.roles=Object(s["a"])(t.data)}))},checkRules:function(){return"edit"===this.flag?this.editRule:this.createRule},getClassName:function(e){for(var t in this.classes)if(this.classes[t].id==e)return this.classes[t].name},getRoleName:function(e){return e.map((function(e){return e.role_name}))},currentChange:function(e){this.currentPage=e,this.searchFlag&&this.searchUser(this.searchText,this.currentPage,this.pageSize),this.initUser()},resetDialog:function(){this.dialog={id:void 0,name:"",roles:[],clazz:void 0,password:"",checkPass:""}},createNewUser:function(){var e=this;this.dialogFormShow=!0,this.flag="create",this.resetDialog(),this.$nextTick((function(){e.$refs["dialog"].clearValidate()}))},handleCreate:function(){var e=this;this.$refs["dialog"].validate((function(t){if(!t)return!1;d(e.dialog).then((function(t){200===t.status&&(e.dialogFormShow=!1,e.total+=1,e.dialog.id=t.data.obj,e.newUser=e.dialog,e.$message({type:"success",message:"添加成功"}))}))["catch"]((function(){e.$message.error("添加失败")}))}))},editUser:function(e){var t=this;this.dialogFormShow=!0,this.flag="edit",e=Object(i["a"])(Object(i["a"])({},e),{},{password:"",checkPass:""}),this.dialog=Object.assign({},e),this.dialog.clazz=e.clazz,this.$nextTick((function(){t.$refs["dialog"].clearValidate()}))},handleUpdate:function(){var e=this;this.$refs["dialog"].validate((function(t){if(!t)return!1;var a=Object.assign({},e.dialog);""===a.password&&(a.password=null),c(a).then((function(){e.userEdit=a,e.dialogFormShow=!1,e.$message({message:"修改成功",type:"success"})}))["catch"]((function(){e.$message({message:"修改失败",type:"error"})}))}))},handleDelete:function(e){var t=this;u(e).then((function(e){200===e.status&&(t.deleteFlag=!0,t.$message({type:"success",message:"删除成功"}),t.total-=1,t.total%t.pageSize==0&&(t.currentPage=t.currentPage-1,t.initUser()))}))["catch"]((function(){t.$message({type:"error",message:"删除失败"})}))},searchUser:function(e,t,a){var r=this;this.searchFlag=!0,1===t&&(this.currentPage=1),h(e,t,a).then((function(e){r.tableData=e.data.obj.data,r.total=e.data.obj.total}))}}},b=m,v=(a("3bc7"),a("2877")),w=Object(v["a"])(b,r,n,!1,null,"3221aa8b",null);t["default"]=w.exports},"7e35":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wrapper"},[a("el-table",{attrs:{data:e.tableData,stripe:""}},[e.index?a("el-table-column",{attrs:{type:"index"}}):e._e(),e._l(e.columns,(function(t){return a("el-table-column",{key:t.id,ref:t.id,refInFor:!0,attrs:{prop:t.id,label:t.label},scopedSlots:e._u([{key:"default",fn:function(a){return[e._t(t.id,[e._v(e._s(a.row[t.id]))],{scope:a})]}}],null,!0)})})),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._t("btnArea",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return e.editItem(t.row)}}},[e._v("编辑")]),a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(a){return e.deleteItem(t.row.id)}}},[e._v("删除")])],{scope:t})]}}],null,!0)})],2)],1)},n=[],i=(a("c975"),a("a434"),a("b85c")),s={name:"normalTable",props:{tableData:Array,columns:Array,flag:String,changed:Object,created:Object,index:Boolean,deleteFlag:Boolean},watch:{changed:function(e){if(null!==e){var t,a=Object(i["a"])(this.tableData);try{for(a.s();!(t=a.n()).done;){var r=t.value;if(r.id===e.id){var n=this.tableData.indexOf(r);this.tableData.splice(n,1,e);break}}}catch(s){a.e(s)}finally{a.f()}}},created:function(e){null!==e&&this.tableData.unshift(e)}},methods:{addNew:function(e){"add"===this.flag&&this.tableData.unshift(e)},editItem:function(e){this.$emit("handleEdit",e)},deleteItem:function(e){var t=this;this.$confirm("是否删除","提示",{comfirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){if(t.$emit("handleDelete",e),1==t.deleteFlag){var a,r=Object(i["a"])(t.tableData);try{for(r.s();!(a=r.n()).done;){var n=a.value;if(n.id==e){var s=t.tableData.indexOf(n);t.tableData.splice(s,1);break}}}catch(l){r.e(l)}finally{r.f()}}}))["catch"]((function(){}))}}},l=s,o=a("2877"),c=Object(o["a"])(l,r,n,!1,null,null,null);t["a"]=c.exports},d81d:function(e,t,a){"use strict";var r=a("23e7"),n=a("b727").map,i=a("1dde"),s=a("ae40"),l=i("map"),o=s("map");r({target:"Array",proto:!0,forced:!l||!o},{map:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}})},daaf:function(e,t,a){}}]);
//# sourceMappingURL=chunk-10025d17.1b9cde17.js.map