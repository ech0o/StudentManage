(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d21e93b"],{d5c7:function(e,t,r){"use strict";r.r(t);var l=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"main"},[r("div",{staticClass:"wrapper"},[r("el-button",{staticStyle:{float:"right"},on:{click:e.handleCreate}},[r("i",{staticClass:"el-icon-plus"}),e._v("添加 ")]),r("el-table",{attrs:{data:e.roleList}},[r("el-table-column",{attrs:{type:"index"}}),r("el-table-column",{attrs:{prop:"roleName",label:"名称"}}),r("el-table-column",{attrs:{prop:"comment",label:"comment"}}),r("el-table-column",{attrs:{label:"action"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"primary"},on:{click:function(r){return e.handleEdit(t)}}},[e._v("编辑")]),r("el-button",{attrs:{type:"danger"},on:{click:function(r){return e.deleteRole(t)}}},[e._v("删除")])]}}])})],1),r("el-dialog",{attrs:{title:e.titleMap[e.dialogStatus],visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("el-form",{ref:"role",attrs:{model:e.role,"label-width":"80px",rules:e.checkRules()}},[r("el-form-item",{attrs:{label:"name",prop:"roleName"}},[r("el-input",{model:{value:e.role.roleName,callback:function(t){e.$set(e.role,"roleName",t)},expression:"role.roleName"}})],1),r("el-form-item",{attrs:{label:"commet",prop:"comment"}},[r("el-input",{model:{value:e.role.comment,callback:function(t){e.$set(e.role,"comment",t)},expression:"role.comment"}})],1),r("el-form-item",{attrs:{label:"menu"}},[r("el-tree",{ref:"tree",attrs:{"check-strictly":e.checkStrictly,data:e.routes,props:e.defaultProps,"node-key":"path","show-checkbox":""}})],1)],1),r("span",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){"create"==e.dialogStatus?e.handleAddRole():e.handleUpdate()}}},[e._v("确 定")])],1)],1)],1)])},a=[],n=(r("a4d3"),r("e01a"),r("d28b"),r("99af"),r("4160"),r("caad"),r("45fc"),r("a434"),r("d3b7"),r("2532"),r("3ca3"),r("159b"),r("ddb0"),r("2909")),i=r("df7c"),o=r.n(i),s=r("2ef0"),c=r.n(s),u=r("4db3");function d(){return Object(u["a"])({url:"/api/roles/all"})}function h(){return Object(u["a"])({url:"/api/route/all"})}var f={id:void 0,roleName:"",comment:"",routes:[]},m={data:function(){return{routesData:[],roleList:[],defaultProps:{children:"children",label:"name"},titleMap:{edit:"edit",create:"create"},dialogStatus:"",checkStrictly:!1,dialogVisible:!1,role:{id:"",roleName:"",comment:"",routes:[]},rules_edit:{roleName:[{required:!0,message:"请输入姓名",trigger:"change"}]},rules_create:{roleName:[{required:!0,message:"请输入姓名",trigger:"blur"}]}}},created:function(){this.getData()},computed:{routes:function(){return this.generateRoutes(this.routesData)}},methods:{getData:function(){var e=this;h().then((function(t){e.routesData=t.data})),d().then((function(t){e.roleList=t.data}))},checkRules:function(){return"edit"===this.dialogStatus?this.rules_edit:this.rules_create},generateRoutes:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",r=[],l=!0,a=!1,n=void 0;try{for(var i,s=e[Symbol.iterator]();!(l=(i=s.next()).done);l=!0){var c=i.value;if(!c.hidden)if(!c.children||1==c.children.length&&c.children.hidden){var u={name:c.meta&&c.meta.title,path:o.a.resolve(t,c.path),children:null};r.push(u)}else{var d={name:c.meta&&c.meta.title,path:o.a.resolve(t,c.path),children:null};c.children&&(d.children=this.generateRoutes(c.children,d.path)),r.push(d)}}}catch(h){a=!0,n=h}finally{try{l||null==s.return||s.return()}finally{if(a)throw n}}return r},generateArr:function(e){var t=this,r=[];return e.forEach((function(e){if(e.children&&e.children.length>0){var l=t.generateArr(e.children);r=[].concat(Object(n["a"])(r),Object(n["a"])(l))}else r.push(e)})),r},generateTree:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",r=arguments.length>2?arguments[2]:void 0,l=[],a=!0,n=!1,i=void 0;try{for(var s,c=e[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var u=s.value,d=o.a.resolve(t,u.path);u.children&&(u.children=this.generateTree(u.children,d,r)),(r.includes(d)||u.children&&u.children.length>=1)&&l.push(u)}}catch(h){n=!0,i=h}finally{try{a||null==c.return||c.return()}finally{if(n)throw i}}return l},handleCreate:function(){var e=this;this.role=Object.assign({},f),this.$refs.tree&&this.$refs.tree.setCheckedNodes([]),this.dialogStatus="create",this.dialogVisible=!0,this.$nextTick((function(){e.$refs["role"].clearValidate()}))},handleEdit:function(e){var t=this;this.dialogVisible=!0,this.dialogStatus="edit",this.role=c.a.cloneDeep(e.row),this.$nextTick((function(){var e=t.generateRoutes(t.role.routes);t.$refs.tree.setCheckedNodes(t.generateArr(e)),t.checkStrictly=!1,t.$refs["role"].clearValidate()}))},handleUpdate:function(){var e=this;this.$refs["role"].validate((function(t){if(!t)return!1;var r=e.$refs.tree.getCheckedKeys();e.role.routes=e.generateTree(c.a.cloneDeep(e.routesData),"/",r);for(var l=0;l<e.roleList.length;l++)if(e.roleList[l].id===e.role.id){e.roleList.splice(l,1,Object.assign({},e.role));break}e.dialogVisible=!1}))},handleAddRole:function(){var e=this;this.$refs["role"].validate((function(t){if(!t)return!1;var r=e.$refs.tree.getCheckedKeys();e.role.routes=e.generateTree(c.a.cloneDeep(e.routesData),"/",r),e.roleList.push(e.role),e.dialogVisible=!1}))},deleteRole:function(e){var t=this;this.$confirm("Confirm to remove the role?","Warning",{ConfirmButtonText:"Confirm",CancelButtonText:"Cancel"}).then((function(){for(var r=0;r<t.roleList.length;r++)if(t.roleList[r].role_name==e.row.role_name){t.roleList.splice(r,1);break}t.$message({type:"success",message:"success"})})).catch((function(){}))},updateRoutes:function(e,t,r){var l=this;e.forEach((function(e){e.matched=!1;var a=!0,n=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var c=o.value;if(e.path===c.path||"*"==e.path||"dashboard"==e.path){e.matched=!0,e.meta.roles.some((function(e){return e===r}))||e.meta.roles.push(r),e.children&&c.children&&l.updateRoutes(e.children,c.children,r);break}}}catch(u){n=!0,i=u}finally{try{a||null==s.return||s.return()}finally{if(n)throw i}}e.matched||l.clearRole(e,r)}))},clearRole:function(e,t){if(Array.isArray(e)){var r=!0,l=!1,a=void 0;try{for(var n,i=e[Symbol.iterator]();!(r=(n=i.next()).done);r=!0){for(var o=n.value,s=0;s<o.meta.roles.length;s++)o.meta.roles[s]===t&&o.meta.roles.splice(s,1);o.matched=!1,o.children&&this.clearRole(o.children,t)}}catch(u){l=!0,a=u}finally{try{r||null==i.return||i.return()}finally{if(l)throw a}}}else{for(var c=0;c<e.meta.roles.length;c++)e.meta.roles[c]===t&&e.meta.roles.splice(c,1);e.children&&this.clearRole(e.children,t)}}}},p=m,v=r("2877"),b=Object(v["a"])(p,l,a,!1,null,null,null);t["default"]=b.exports}}]);
//# sourceMappingURL=chunk-2d21e93b.e8ece200.js.map