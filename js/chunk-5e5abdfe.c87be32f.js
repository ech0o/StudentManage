(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5e5abdfe"],{"7e35":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wrapper"},[a("el-table",{attrs:{data:e.tableData,stripe:""}},[e.index?a("el-table-column",{attrs:{type:"index"}}):e._e(),e._l(e.columns,(function(t){return a("el-table-column",{key:t.id,ref:t.id,refInFor:!0,attrs:{prop:t.id,label:t.label},scopedSlots:e._u([{key:"default",fn:function(a){return[e._t(t.id,[e._v(e._s(a.row[t.id]))],{scope:a})]}}],null,!0)})})),a("el-table-column",{attrs:{label:"操作",width:e.width},scopedSlots:e._u([{key:"default",fn:function(t){return[e._t("btnArea",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return e.editItem(t.row)}}},[e._v("编辑")]),a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(a){return e.deleteItem(t.row.id)}}},[e._v("删除")])],{scope:t})]}}],null,!0)})],2)],1)},l=[],n=(a("c975"),a("a434"),a("a9e3"),a("b85c")),i={name:"normalTable",props:{tableData:Array,columns:Array,flag:String,changed:Object,created:Object,index:Boolean,deleteFlag:Boolean,width:Number},watch:{changed:function(e){if(null!==e){var t,a=Object(n["a"])(this.tableData);try{for(a.s();!(t=a.n()).done;){var r=t.value;if(r.id===e.id){var l=this.tableData.indexOf(r);this.tableData.splice(l,1,e);break}}}catch(i){a.e(i)}finally{a.f()}}},created:function(e){null!==e&&this.tableData.unshift(e)}},methods:{addNew:function(e){"add"===this.flag&&this.tableData.unshift(e)},editItem:function(e){this.$emit("handleEdit",e)},deleteItem:function(e){var t=this;this.$confirm("是否删除","提示",{comfirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){if(t.$emit("handleDelete",e),1==t.deleteFlag){var a,r=Object(n["a"])(t.tableData);try{for(r.s();!(a=r.n()).done;){var l=a.value;if(l.id==e){var i=t.tableData.indexOf(l);t.tableData.splice(i,1);break}}}catch(o){r.e(o)}finally{r.f()}}}))["catch"]((function(){}))}}},o=i,s=a("2877"),c=Object(s["a"])(o,r,l,!1,null,null,null);t["a"]=c.exports},d5c7:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"main"},[a("div",{staticClass:"wrapper"},[e._m(0),a("el-card",[a("el-button",{staticStyle:{float:"right"},on:{click:e.handleCreate}},[a("i",{staticClass:"el-icon-plus"}),e._v("添加 ")]),a("normal-table",{attrs:{tableData:e.roleList,columns:e.columns,width:200,index:!0},scopedSlots:e._u([{key:"btnArea",fn:function(t){var r=t.scope;return[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.handleEdit(r)}}},[e._v("编辑")]),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteRole(r)}}},[e._v("删除")])]}}])})],1),a("el-dialog",{attrs:{title:e.titleMap[e.dialogStatus],visible:e.dialogVisible,center:""},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"role",attrs:{model:e.role,"label-width":"80px",rules:e.checkRules()}},[a("el-form-item",{attrs:{label:"name",prop:"roleName"}},[a("el-input",{model:{value:e.role.roleName,callback:function(t){e.$set(e.role,"roleName",t)},expression:"role.roleName"}})],1),a("el-form-item",{attrs:{label:"commet",prop:"comment"}},[a("el-input",{model:{value:e.role.comment,callback:function(t){e.$set(e.role,"comment",t)},expression:"role.comment"}})],1),a("el-form-item",{attrs:{label:"menu"}},[a("el-tree",{ref:"tree",attrs:{"check-strictly":e.checkStrictly,data:e.routes,props:e.defaultProps,"node-key":"path","show-checkbox":""}})],1)],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){"create"==e.dialogStatus?e.handleAddRole():e.handleUpdate()}}},[e._v("确 定")])],1)],1)],1)])},l=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"title"},[a("h2",[e._v("角色管理")])])}],n=(a("99af"),a("4160"),a("caad"),a("277d"),a("45fc"),a("a434"),a("2532"),a("159b"),a("2909")),i=a("b85c"),o=a("df7c"),s=a.n(o),c=a("2ef0"),d=a.n(c),u=a("4db3");function h(){return Object(u["a"])({url:"/api/roles/all"})}function f(){return Object(u["a"])({url:"/api/route/all"})}var m=a("7e35"),p={id:void 0,roleName:"",comment:"",routes:[]},b={name:"roleManage",components:{normalTable:m["a"]},data:function(){return{routesData:[],roleList:[],defaultProps:{children:"children",label:"name"},titleMap:{edit:"edit",create:"create"},dialogStatus:"",checkStrictly:!1,dialogVisible:!1,role:{id:"",roleName:"",comment:"",routes:[]},rules_edit:{roleName:[{required:!0,message:"请输入姓名",trigger:"change"}]},rules_create:{roleName:[{required:!0,message:"请输入姓名",trigger:"blur"}]},columns:[{id:"roleName",label:"名称"},{id:"comment",label:"备注"}],createRole:void 0,editRole:void 0,deleteFlag:!1}},created:function(){this.getData()},computed:{routes:function(){return this.generateRoutes(this.routesData)}},methods:{getData:function(){var e=this;f().then((function(t){e.routesData=t.data})),h().then((function(t){e.roleList=t.data}))},checkRules:function(){return"edit"===this.dialogStatus?this.rules_edit:this.rules_create},generateRoutes:function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",r=[],l=Object(i["a"])(e);try{for(l.s();!(t=l.n()).done;){var n=t.value;if(!n.hidden)if(!n.children||1==n.children.length&&n.children.hidden){var o={name:n.meta&&n.meta.title,path:s.a.resolve(a,n.path),children:null};r.push(o)}else{var c={name:n.meta&&n.meta.title,path:s.a.resolve(a,n.path),children:null};n.children&&(c.children=this.generateRoutes(n.children,c.path)),r.push(c)}}}catch(d){l.e(d)}finally{l.f()}return r},generateArr:function(e){var t=this,a=[];return e.forEach((function(e){if(e.children&&e.children.length>0){var r=t.generateArr(e.children);a=[].concat(Object(n["a"])(a),Object(n["a"])(r))}else a.push(e)})),a},generateTree:function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",r=arguments.length>2?arguments[2]:void 0,l=[],n=Object(i["a"])(e);try{for(n.s();!(t=n.n()).done;){var o=t.value,c=s.a.resolve(a,o.path);o.children&&(o.children=this.generateTree(o.children,c,r)),(r.includes(c)||o.children&&o.children.length>=1)&&l.push(o)}}catch(d){n.e(d)}finally{n.f()}return l},handleCreate:function(){var e=this;this.role=Object.assign({},p),this.$refs.tree&&this.$refs.tree.setCheckedNodes([]),this.dialogStatus="create",this.dialogVisible=!0,this.$nextTick((function(){e.$refs["role"].clearValidate()}))},handleEdit:function(e){var t=this;this.dialogVisible=!0,this.dialogStatus="edit",this.role=d.a.cloneDeep(e.row),this.$nextTick((function(){var e=t.generateRoutes(t.role.routes);t.$refs.tree.setCheckedNodes(t.generateArr(e)),t.checkStrictly=!1,t.$refs["role"].clearValidate()}))},handleUpdate:function(){var e=this;this.$refs["role"].validate((function(t){if(!t)return e.$message.error("修改失败"),!1;var a=e.$refs.tree.getCheckedKeys();e.role.routes=e.generateTree(d.a.cloneDeep(e.routesData),"/",a);for(var r=0;r<e.roleList.length;r++)if(e.roleList[r].id===e.role.id){e.roleList.splice(r,1,Object.assign({},e.role));break}e.dialogVisible=!1,e.$message({type:"success",message:"修改成功"})}))},handleAddRole:function(){var e=this;this.$refs["role"].validate((function(t){if(!t)return e.$message.error("添加失败"),!1;var a=e.$refs.tree.getCheckedKeys();e.role.routes=e.generateTree(d.a.cloneDeep(e.routesData),"/",a),e.roleList.push(e.role),e.dialogVisible=!1,e.$message({type:"success",message:"添加成功"})}))},deleteRole:function(e){var t=this;this.$confirm("是否删除","提示",{ConfirmButtonText:"确定",CancelButtonText:"取消",type:"warning"}).then((function(){for(var a=0;a<t.roleList.length;a++)if(t.roleList[a].role_name==e.row.role_name){t.roleList.splice(a,1);break}t.$message({type:"success",message:"已删除"})}))["catch"]((function(){}))},updateRoutes:function(e,t,a){var r=this;e.forEach((function(e){e.matched=!1;var l,n=Object(i["a"])(t);try{for(n.s();!(l=n.n()).done;){var o=l.value;if(e.path===o.path||"*"==e.path||"dashboard"==e.path){e.matched=!0,e.meta.roles.some((function(e){return e===a}))||e.meta.roles.push(a),e.children&&o.children&&r.updateRoutes(e.children,o.children,a);break}}}catch(s){n.e(s)}finally{n.f()}e.matched||r.clearRole(e,a)}))},clearRole:function(e,t){if(Array.isArray(e)){var a,r=Object(i["a"])(e);try{for(r.s();!(a=r.n()).done;){for(var l=a.value,n=0;n<l.meta.roles.length;n++)l.meta.roles[n]===t&&l.meta.roles.splice(n,1);l.matched=!1,l.children&&this.clearRole(l.children,t)}}catch(s){r.e(s)}finally{r.f()}}else{for(var o=0;o<e.meta.roles.length;o++)e.meta.roles[o]===t&&e.meta.roles.splice(o,1);e.children&&this.clearRole(e.children,t)}}}},v=b,g=a("2877"),y=Object(g["a"])(v,r,l,!1,null,null,null);t["default"]=y.exports}}]);
//# sourceMappingURL=chunk-5e5abdfe.c87be32f.js.map